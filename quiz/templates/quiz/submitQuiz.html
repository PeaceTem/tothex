

{% extends 'quiz/base.html' %}

{% load static %}
{% load social_share %}
{% block quizTitle %}
Quiz Submit
{% endblock quizTitle %}

{% block content %}

{% block quizCss %}
<link rel="stylesheet" href="{% static 'quiz/css/submitQuiz.css' %}">
{% endblock quizCss %}





<div class="question-card-container">
    <div>
        <div class="link-container">
            <a href="{% url 'quiz:quizzes' %}">Go back home</a>
        </div>
    </div>

    <div>
        <div class="link-container">
            <a href="{% url 'profile:profile' quiz.user %}">
                @{{quiz.user}}
            </a>
        </div>
    </div>

    
{% include 'messages.html'%}

    <div>
        {{attempt_report}}
        <br>
        You scored: {{user_score}}/{{total_score}}
        <br>
        Quiz's average score: {{avgScore}}%
        <br>
        Your Average Score: {{user_avg_score}}%
        <br>
        {{timeTaken}}
    </div>
</div>


<div class="question-card-container download-quiz">
        You don't see the solutions to questions you didn't answer!
        <ol>
        
        {% for question, answer in questionsList %}
        <div class="question-box">

            {% if question.form == 'fourChoicesQuestion' %}
        <li class="question">

            <div class="indicator"></div>

            <div>
                    {{question.question|linebreaksbr}} <br>
                    <div class="points">
                        {% if question.points < 2 %}
                        {{question.points}} point
                    {% else %}
                        {{question.points}} points
                    {% endif %}
                    </div>
                    <ol class="answers">
                        {% if question.correct == 'answer1' %}
                        <li class="answerGreen">
                            <div class="answer">
                                {{question.answer1|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer1}}</div>
                        </li>
                        {% elif answer == question.answer1 %}
                        
                        <li class="answerRed">
                            <div class="answer">
                                {{question.answer1|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer1}}</div>
                        </li>

                        {% else %}

                        <li class="answerWhite">
                            <div class="answer">
                                {{question.answer1|linebreaksbr}}  
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer1}}</div>
                        </li>

                        {% endif %}






                        {% if question.correct == 'answer2' %}
                        <li class="answerGreen">
                            <div class="answer">
                                {{question.answer2|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer2}}</div>
                        </li>
                        {% elif answer == question.answer2 %}
                        
                        <li class="answerRed">
                            <div class="answer">
                                {{question.answer2|linebreaksbr}} 
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer2}}</div>
                        </li>

                        {% else %}

                        <li class="answerWhite">
                            <div class="answer">
                                {{question.answer2|linebreaksbr}} 
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer2}}</div>
                        </li>

                        {% endif %}






                        {% if question.correct == 'answer3' %}
                        <li class="answerGreen">
                            <div class="answer">
                                {{question.answer3|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer3}}</div>
                        </li>
                        {% elif answer == question.answer3 %}
                        
                        <li class="answerRed">
                            <div class="answer">
                                {{question.answer3|linebreaksbr}} 
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer3}}</div>
                        </li>

                        {% else %}

                        <li class="answerWhite">
                            <div class="answer">
                                {{question.answer3|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer3}}</div>
                        </li>

                        {% endif %}






                        {% if question.correct == 'answer4' %}
                        <li class="answerGreen">
                            <div class="answer">
                                {{question.answer4|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer4}}</div>
                        </li>
                        {% elif answer == question.answer4 %}
                        
                        <li class="answerRed">
                            <div class="answer">
                                {{question.answer4|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer4}}</div>
                        </li>

                        {% else %}

                        <li class="answerWhite">
                            <div class="answer">
                                {{question.answer4|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer4}}</div>
                        </li>

                        {% endif %}





                    </ol>
                    <div class="solution">
                        Solution: {{question.solution|linebreaksbr}}
                    </div>
               
            </div>
        </li>
            {% elif question.form == 'trueOrFalseQuestion' %}
            <li class="question">
                <div class="indicator"></div>


                <div>
                        {{question.question|linebreaksbr}} <br>
                        <div class="points">
                            {% if question.points < 2 %}
                            {{question.points}} point
                        {% else %}
                            {{question.points}} points
                        {% endif %}
                        </div>
                        <ol class="answers">
                            {% if question.correct == 'True' %}
                        <li class="answerGreen">
                            <div class="answer">
                                {{question.answer1|linebreaksbr}} 
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer1}}</div>
                        </li>
                        {% elif answer == question.answer1 %}
                        
                        <li class="answerRed">
                            <div class="answer">
                                {{question.answer1|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer1}}</div>
                        </li>

                        {% else %}

                        <li class="answerWhite">
                            <div class="answer">
                                {{question.answer1|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer1}}</div>
                        </li>

                        {% endif %}






                        {% if question.correct == 'False' %}
                        <li class="answerGreen">
                            <div class="answer">
                                {{question.answer2|linebreaksbr}}
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer2}}</div>
                        </li>
                        {% elif answer == question.answer2 %}
                        
                        <li class="answerRed">
                            <div class="answer">
                                {{question.answer2|linebreaksbr}} 
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer2}}</div>
                        </li>

                        {% else %}

                        <li class="answerWhite">
                            <div class="answer">
                                {{question.answer2|linebreaksbr}} 
                            </div>
                            <div class="percentage">{{question.get_percentage_chosen_of_answer2}}</div>
                        </li>

                        {% endif %}


                            <div style="display:none;">
                                Your Answer:
                                <span class="yourAnswer">
                                {{answer|safe}}}
                            </span>
                            </div>
                           
                        </ol>
                        <div class="solution">
                            Solution: {{question.solution|linebreaksbr}}
                        </div>
                   
                </div>
            </li>

            {% endif %}
        </div>
        {% endfor %}
    </ol>




    {% if attempters %}
    Highest scores
    <ol class="scores">
    {% for attempter in attempters %}
    <div>
        <li>
            <span>@{{attempter.user}}</span>
            <span>{{attempter.score}}</span>
            <span>{{attempter.get_percentage}}</span>
            <div style="font-size: 11px; color: #999; font-style: italic; ">
                {{attempter.get_timetaken}}
            </div>
        </li>
    </div>
   
    {% endfor %}
    </ol>
    {% endif %}
    





    </div>
<div class="question-card-container">
    <div class="linkBx">
        <div id="likes">
         
            <form data-quiz="{{quiz.id}}" data-url="{% url 'quiz:post-like' %}" data-id="likeForm{{quiz.id}}" id="likeForm{{quiz.id}}" method="post" class="likeForm">
                {% csrf_token %}
                <input type="hidden" name="quiz_id" value="{{quiz.id}}">
                {% if not user in quiz.likes.all %}
                    <button id="like{{quiz.id}}" type="submit">
                        <div style="color:#fff;" id="likeButton{{quiz.id}}" >like</div>
                    </button>
                {% else %}
                    <button id="like{{quiz.id}}" type="submit">
                        <div  style="color:#fff;" id="likeButton{{quiz.id}}" >unlike</div>
                    </button>
                {% endif %}
            </form>
        </div>
    </div>
    <div style="display:none; max-width: 500px;" class="result">
    
    </div>
    <div>
        <a href="{% url 'quiz:random-quiz-picker' %}">Take Another Quiz</a>
    </div>
    {% if user.is_authenticated %}
    {% if not user in quiz.solution_validators.all %}
    <div>
        <form method="get" id="solutionQualityForm" data-url="{% url 'quiz:solution-quality' quiz.id %}">
            <div>Are the solutions helpful?</div>
            <div> <i style="text-align:center; font-size: 11px;">This helps us to estimate the quality of this quiz</i> </div>
        <input type="radio" id="yes"  name="quality" value="Yes">
        <label for="yes">Yes</label>
        <input type="radio" id="no"  name="quality" value="No">
        <label for="no">No</label>
        <br>
        <input type="submit" value="Submit">
    </form>
    </div>
    {% endif %}
    {% endif %}
    <div>
        <div class="link-container">
            <a href="{% url 'quiz:take-quiz' quiz.id %}">Re-take Quiz</a>
        </div>
    </div>
    
    <div>
        <div class="link-container">
            <a href="" class="a">Download the Image</a>
        </div>
    </div>
   
    <div>
        <div class="link-container">
            <a href="{% url 'quiz:quiz-pdf' quiz.id %}">
                Download the Pdf
            </a>
        </div>
    </div>


<div>
    <img src="{{postAd.picture.url}}">
</div>

<div>
    {{postAd.description|linebreaksbr}}
</div>

<div class="link-container">
    <a class="postAd" onclick="clickFunction()" data-url="{% url 'ads:post-click' postAd.id 'submit' %}" href="{{postAd.link}}" target="_blank">Visit Site</a>
</div>


<div class="social-share">
    <i style="font-size: 12px; color: #777;">Refer To Earn More Coins (20 coins per click)</i>
    
{% post_to_facebook  object_or_url 'Post to Facebook' %}
{% post_to_twitter "Take A Quiz: {{quiz.title}}" object_or_url "Post to Twitter" %}
{% post_to_linkedin  object_or_url "Post to" %}
{% send_email "ToTheX Quiz" "Take A Quiz: {{quiz.title}}" object_or_url "Share via email" %}
{% post_to_reddit "Take A Quiz: {{quiz.title}}" object_or_url %}
{% post_to_telegram "Take A Quiz: {{quiz.title}}" object_or_url %}
{% post_to_whatsapp object_or_url "Share via WhatsApp" %}
{% save_to_pinterest object_or_url %}
</div>

{% if quizLink %}
<div>
    <span>Link below: </span>
        <div class="link-container">
        <a onclick="QuizLinkClickFunction()" data-url="{% url 'quiz:quiz-link-click-counter' quizLink.id %}" class="profile-link" href="{{quizLink.link}}" target="_blank" rel="noopener noreferrer">{{quizLink.name}}</a>
        </div>
        <div style="font-size: 12px; color: #777;">
            {{quizLink.description}}
        </div>
        {% if request.user.is_authenticated and request.user not in quizLink.reporters.all %}
            <form id="report" action="{% url 'quiz:report-link' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="quizlink_id" value="{{quizLink.id}}">
                <input type="hidden" name="user" value="{{request.user.id}}">
                <div class ="link-container">
                    <input class="report-link" type="submit" value="Report Link">
                </div>
            </form>
        {% endif %}
</div>
{% endif %}

</div>

<script src="{% static 'question/html2canvas.js' %}"></script>
<script src="{% static 'js/jquery.js' %}"></script>
<script>

    let elm = document.querySelector('.download-quiz');
    elm.prepend("");
    html2canvas(elm).then(function(canvas){
        document.querySelector('.result').append(canvas);
        let cvs = document.querySelector('canvas');
        let a = document.querySelector('.a');
        a.href = cvs.toDataURL();
        a.download = 'ToTheX-{{quiz.quiz.title}}.png'
    })




    function clickFunction(){
        $.ajax({
            // change this to post
            type: 'GET', 
            url : $('a.postAd').data('url'),
            data : {
            },
            success : function(response){
                alert('link clicked!')
                

            },
            error : function(){
                alert('It falis silently!')
            }

        });

    }


    function QuizLinkClickFunction(){
        $.ajax({
            // change this to post
            type: 'GET', 
            url : $('a.profile-link').data('url'),
            data : {
                quizlink : $('a#report-link').data('id'),
                reporter : $('a#report-link').data('user'),
            },
            success : function(response){
                alert('link clicked!')
                
                

            },
            error : function(){
                alert('It falis silently!')
            }

        });

    }


$('form#report').submit(function(e){
    e.preventDefault();
        alert('click!')
        const serializedData = $('form#report').serialize();
        $.ajax({
            // change this to post
            type: 'POST', 
            url : $('form#report').attr('action'),
            data : serializedData,
            success : function(response){
                alert('link clicked!')
                $('form#report').hide(500);
                console.log(response);
                console.log('Why are you prosecuting me?')

                

            },
            error : function(response){
                alert('It falis silently!')
                console.log(response)
            }

        });

})


function ActivateForm(){
    const solution = document.getElementById('solutionQualityForm');
    solution.submit();
}


    $(document).on('submit', '#solutionQualityForm', function(e){
    e.preventDefault();
        const object = $('#solutionQualityForm');
        const dataList = object.serialize()
        $.ajax({
            // change this to post
            type: 'GET', 
            // serialize the data
            url : $('#solutionQualityForm').data('url'),
            data : dataList,
            success : function(response){
                $('#solutionQualityForm').parent().hide(1000);
                

            },
            error : function(){
            }

        });
        });




$('.likeForm').submit(function(e){
e.preventDefault();
const serializeData = $(this).serialize()
const quiz_id = $(this).data('quiz')
// alert('Still working!')
// alert(serializeData)
$.ajax({
    type: 'POST',
    url : $(this).data('url'),
    data : serializeData,
    success : function(response){
        // alert('It works');
        // document.querySelector('#deleteButton').parentNode.parentNode.style.display = 'none';
        // console.log(id);
        // console.log(response)
        
        if (response == 'liked'){
            // console.log($(`#likeButton${id}`));
            $(`#likeButton${quiz_id}`).text('unlike');
        }else if (response == 'unliked'){
            // console.log($(`#unlikeButton${id}`));
            $(`#likeButton${quiz_id}`).text('like');
        }
        

    },
    error : function(){
        alert('It falis silently!')
    }

});
})

// console.log(document.querySelector('.social-share'))

// const yourAnswer = document.getElementsByClassName('yourAnswer')
//     const correctAnswer = document.getElementsByClassName('correctAnswer')
//     const indicators = document.getElementsByClassName('indicator')
//     for(let i = 0; i < yourAnswer.length; i++){
//         console.log(yourAnswer[i].innerText)
//         console.log(correctAnswer[i].innerText)
//         if(yourAnswer[i].innerText  == correctAnswer[i].innerText){
//             indicators[i].style.backgroundColor =  'green';
//             console.log('correct!');
//         }else{
//             indicators[i].style.backgroundColor =  'red';
//             console.log('wrong!');
//         }
//     }


</script>
{% endblock content %}