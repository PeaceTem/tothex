{% extends 'base.html' %}
{% load static %}

{% block title %}
Categories
{% endblock title %}

{% block content %}

{% block css %}
<link rel="stylesheet" href="{% static 'quiz/css/categoryCreate.css' %}">
{% endblock css %}
{% include 'core/header.html' %}

<section>
    {% if obj_type == 'quiz' %}
    <div class="head">Step 2 of 3</div>
    {% else %}
    <div class="head">Step 2 of 2</div>
    {% endif %}

<h3>Add Categories</h3>
{% if obj_type == 'quiz' %}
    <div class="top-info">
        You can add up to 3 categories <br>Categories: <b>{{quizCategories.count}}</b>
    </div>
    <!-- <input type="hidden" name="quiz" id="quiz" value="{{quiz.id}}"> -->
{% else %}
<div class="top-info">
    You can add up to 5 categories <br>Categories: {{questionCategories.count}}
</div>
{% endif %}


{% include 'messages.html' %}
<div class="category-create" >
    <form action="" id="category-form" method="get">
        <input id="Search" value=""  type="text" name="newCategory" id="newCategory" placeholder="search or create">
        <input type="submit" value="search">
    </form>
</div>


<form action="" id="added-category-form" method="get">
    click on a category in this bucket to remove it<br>
    <fieldset>
        <legend>Bucket</legend>
        <div id="categoryBucket">
            {% for category in objCategories %}
                <input type='text' id="{{category.title}}"  class="addedCategories" onclick="removeCategory(this.id)" name="addedCategories" value={{category.title}} readonly>
            {% endfor %}
        </div>
    </fieldset>
    add all the categories in the bucket to the quiz
    <input type="submit" value="Add">
</form>


<!-- Add infinite scroll to the category with ajax -->
<div class="info">
    Click on any of the categories below to add it to the bucket above<br>
</div>


<div id="infinite-container">

{% for category in page_obj %}
<span class="infinite-item">
    <input type="button" onclick="addClassCategory(this.value)" value="{{category.title}}">
</span>
{% endfor %}
</div>
<div>
    {% if obj_type == 'quiz' %}
<a href="{% url 'quiz:new-question' quiz.id %}">
    <button>Add more Questions</button>
</a>
    {% else %}
    <a href="{% url 'question:new-question' %}">
        Add more Questions
    </a>
    
    {% endif %}
</div>
</section>


{% include 'jquery.html' %}

<script type="text/javascript">
        var bucket = document.getElementById('categoryBucket');
function addClassCategory(obj_name){

        bucket.innerHTML += `
                                <input type="text" class = "addedCategories" name="addedCategories" value=${obj_name} readonly>
                            `;
    }

function removeCategory(index){
    let elem = document.getElementById(index);
    elem.parentNode.removeChild(elem);
}

var search = document.querySelector('#Search').value;
function checkSearchAndReload(){
    let response = document.querySelector('#Search').value;
        if (search != response){
            search = response;

            if(response != ''){
            collectCategories(response);
            };
        };


}

setInterval(checkSearchAndReload, 2500);

function collectCategories(searchData){
    let categoriesContainer = document.getElementById('infinite-container');

	$.ajax({
	type : 'GET',
	url : "{% url 'category:category-list' %}",
	data : {text: searchData},
	success : function(response){
        categoriesContainer.innerHTML = '';
        for(let res of response){
            categoriesContainer.innerHTML += `
            <span class="infinite-item">
                <input type="button" onclick="addClassCategory(this.value)" value="${res.title}">
            </span>
                            `;
        }
		},
	error : function(response){
		alert('An error occurred!');
		},
});

};

</script>
   
</body>
</html>
{% endblock content %}
